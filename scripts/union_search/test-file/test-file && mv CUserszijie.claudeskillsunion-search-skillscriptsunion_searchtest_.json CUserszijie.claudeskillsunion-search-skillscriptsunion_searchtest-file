#!/usr/bin/env python3
"""åˆ†æ union_search æœç´¢ç»“æœå¹¶å»é‡"""

import json

# è¯»å–ä¹‹å‰çš„æœç´¢ç»“æœï¼ˆç®€åŒ–ç‰ˆæœ¬ç”¨äºåˆ†æï¼‰
results_json = '''
{
  "results": {
    "reddit": {"items": [
      {"title": "HADRONäº‘ AIäººå·¥æ™ºèƒ½ æµè§ˆå™¨æŒ–çŸ¿ 30ç§’å¼€æŒ–", "link": "https://www.reddit.com/r/ChineseReddit/comments/7r369s/"},
      {"title": "ä¸­å›½ææœ‰å¯èƒ½å·²ç»å†å²æ€§åœ°é”™è¿‡äº†GDPæ€»é¢è¶…è¿‡ç¾å›½çš„çª—å£æœŸ", "link": "https://www.reddit.com/r/China_irl/comments/1aelu0b/"},
      {"title": "æ‡‚å¾—æå¥½é—®é¢˜ï¼Œæ˜¯ç”¨å¥½AIçš„å…³é”®ï¼Œé™„èµ 10ä¸ªè°ƒæ•™è¯æœ¯", "link": "https://www.reddit.com/r/wakin2025/comments/1ojqi39/"}
    ]},
    "bilibili": {"items": [
      {"title": "ã€æ•´æ•´600é›†ã€‘æ¸…åå¤§å­¦196å°æ—¶è®²å®Œçš„AIäººå·¥æ™ºèƒ½ä»å…¥é—¨åˆ°ç²¾é€šå…¨å¥—æ•™ç¨‹", "url": "https://www.bilibili.com/video/BV1qZSLBYEpa"},
      {"title": "ã€å…¨748é›†ã€‘ç›®å‰Bç«™æœ€å…¨æœ€ç»†çš„AIå¤§æ¨¡å‹é›¶åŸºç¡€å…¨å¥—æ•™ç¨‹", "url": "https://www.bilibili.com/video/BV1xfBkB4Etb"},
      {"title": "é›¶åŸºç¡€äººå·¥æ™ºèƒ½å…¥é—¨ã€æ·±åº¦å­¦ä¹ +PyTorchã€‘", "url": "https://www.bilibili.com/video/"}
    ]},
    "github": {"items": [
      {"name": "Awesome-AI", "html_url": "https://github.com/runningcheese/Awesome-AI"},
      {"name": "AI-YinMei", "html_url": "https://github.com/worm128/AI-YinMei"},
      {"name": "True_Artificial_Intelligence", "html_url": "https://github.com/makelove/True_Artificial_Intelligence"}
    ]},
    "weibo": {"items": []},
    "twitter": {"items": []},
    "douyin": {"items": [
      {"title": "AIåº”è¯¥æ˜¯è¾…åŠ©äººç±»å·¥ä½œï¼Œä¸ºæˆ‘ä»¬å‡è½»è´Ÿæ‹…ã€æé«˜æ•ˆç‡"},
      {"title": "æ³¢å£«é¡¿æœºå™¨äººå’Œæˆ‘ä»¬çš„æ˜¥æ™šæœºå™¨äººç›¸æ¯”ï¼Œè°æ›´ä½³ä¼˜ç§€å‘¢ï¼Ÿ"},
      {"title": "çˆ±å¥½è€…ç”¨AI ç”Ÿæˆæœºå™¨äººä¸Šæˆ˜åœºçš„æ•ˆæœï¼Œä¸€èµ·æ„Ÿå—ä¸‹å§ï½"}
    ]},
    "xiaohongshu": {"items": []},
    "youtube": {"items": [
      {"title": "ç¾å›½AIç•Œå½»åº•ç‚¸é”…ï¼ä¸­å›½18å²é«˜ä¸­ç”Ÿï¼Œç”¨ä¸€å¼ A4çº¸å¹²ç¿»äº†OpenAIï¼", "url": "https://www.youtube.com/watch?v=emUlC5wozDs"},
      {"title": "ã€äººå·¥æ™ºèƒ½ã€‘10ä¸‡äº¿ç¾å…ƒçš„AIé©å‘½ | çº¢æ‰èµ„æœ¬ç¾å›½", "url": "https://www.youtube.com/watch?v=Cv4JewJH5uM"},
      {"title": "çµ¦éå°ˆæ¥­äººå£«è£½ä½œçš„ AIæ¦‚å¿µè§£æ", "url": "https://www.youtube.com/watch?v=r1O-guROtWQ"}
    ]},
    "xiaoyuzhoufm": {"items": [
      {"title": "æå½¦å®å‡­ä»€ä¹ˆæ‰“åŠ¨å¤§è¯å‚ï¼Ÿ", "url": "https://www.xiaoyuzhoufm.com/episode/6544b5abba68d8e3abd4361f"},
      {"title": "äººå·¥æ™ºèƒ½", "url": "https://www.xiaoyuzhoufm.com/episode/6311f841433755901224104b"},
      {"title": "Vol.24|AIè¯´å©šå§»|å½“ä»£ä¸­å¹´å¥³æ€§å¦‚ä½•ä¿æŒæ¸…é†’çš„å©šå§»è§‚", "url": "https://www.xiaoyuzhoufm.com/episode/6450c8683a34effcc1a9e62f"}
    ]},
    "google": {"items": [
      {"title": "EU AI Act", "url": "https://artificialintelligenceact.eu/"},
      {"title": "Artificial Intelligence Action Summit", "url": "https://www.elysee.fr/en/sommet-pour-l-action-sur-l-ia"},
      {"title": "ä»€éº¼æ˜¯äººå·¥æ™ºæ…§(AI)ï¼Ÿ - Google Cloud", "url": "https://cloud.google.com/learn/what-is-artificial-intelligence"}
    ]},
    "tavily": {"items": [
      {"title": "äººå·¥æ™ºèƒ½(AI) - Tableau", "url": "https://www.tableau.com/zh-cn/data-insights/ai"},
      {"title": "ä»€ä¹ˆæ˜¯äººå·¥æ™ºèƒ½(AI)ï¼Œäººå·¥æ™ºèƒ½çš„é‡è¦æ€§ä½•åœ¨ - NetApp", "url": "https://www.netapp.com/zh-hans/artificial-intelligence/what-is-artificial-intelligence/"},
      {"title": "äººå·¥æ™ºèƒ½ - ç¶­åŸºå¤§å…¸", "url": "https://zh-classical.wikipedia.org/wiki/äººå·¥æ™ºèƒ½"}
    ]},
    "duckduckgo": {"items": [
      {"title": "Humanize Your AI Text - JustDone", "url": "https://justdone.com/ai-humanizer"},
      {"title": "Humanize Your AI Text - JustDone", "url": "https://justdone.com/ai-humanizer"},
      {"title": "Humanize Your AI Text - JustDone", "url": "https://justdone.com/ai-humanizer"}
    ]},
    "yahoo": {"items": [
      {"title": "äººå·¥æ™ºèƒ½ï¼ˆæ™ºèƒ½ç§‘å­¦ä¸æŠ€æœ¯ä¸“ä¸šæœ¯è¯­ï¼‰_ç™¾åº¦ç™¾ç§‘", "href": "https://baike.baidu.com/item/äººå·¥æ™ºèƒ½/9180"},
      {"title": "äººå·¥æ™ºèƒ½ - ç»´åŸºç™¾ç§‘", "href": "https://zh.wikipedia.org/wiki/äººå·¥æ™ºèƒ½"},
      {"title": "äººå·¥æ™ºèƒ½ (AI) æ˜¯ä»€ä¹ˆï¼Ÿ| IBM", "href": "https://www.ibm.com/cn-zh/think/topics/artificial-intelligence"}
    ]},
    "bing": {"items": [
      {"title": "äººå·¥æ™ºèƒ½ - çŸ¥ä¹", "href": "https://www.zhihu.com/topic/19551275"},
      {"title": "ç›®å‰æœ‰å“ªäº›ä¸»æµçš„AIï¼Ÿ - çŸ¥ä¹", "href": "https://www.zhihu.com/question/591009674"},
      {"title": "äººå·¥æ™ºèƒ½æ˜¯ä»€ä¹ˆï¼Ÿ - çŸ¥ä¹", "href": "https://www.zhihu.com/question/20229908"}
    ]},
    "volcengine": {"items": []},
    "wikipedia": {"items": []},
    "metaso": {"items": [
      {"title": "äººå·¥æ™ºèƒ½ï¼ˆAIï¼‰", "url": "https://blog.csdn.net/weixin_44115082/article/details/146247874"},
      {"title": "äººå·¥æ™ºèƒ½ï¼ˆArtificial Intelligenceï¼ŒAIï¼‰", "url": "https://m.sohu.com/a/739037837_121734590/"},
      {"title": "äººå·¥æ™ºèƒ½(Artificial Intelligence, AI)", "url": "https://m.juming.com/zx/18632.html"}
    ]},
    "rss": {"items": []},
    "zhihu": {"items": [
      {"title": "çŸ¥ä¹å›ç­”1", "url": "https://www.zhihu.com/question/644109561/answer/1951618784059176580"},
      {"title": "çŸ¥ä¹ç”µå­ä¹¦", "url": "https://www.zhihu.com/pub/book/120512059"},
      {"title": "çŸ¥ä¹å›ç­”2", "url": "https://www.zhihu.com/question/658385796/answer/1961480485474662104"}
    ]},
    "brave": {"items": [
      {"title": "What is Artificial Intelligence (AI)? | Google Cloud", "url": "https://cloud.google.com/learn/what-is-artificial-intelligence"},
      {"title": "What is Artificial Intelligence (AI) | NetApp", "url": "https://www.netapp.com/artificial-intelligence/what-is-artificial-intelligence/"},
      {"title": "äººå·¥æ™ºèƒ½ - ç»´åŸºç™¾ç§‘ï¼Œè‡ªç”±çš„ç™¾ç§‘å…¨ä¹¦", "url": "https://zh.wikipedia.org/wiki/äººå·¥æ™ºèƒ½"}
    ]}
  },
  "summary": {
    "total_platforms": 20,
    "successful": 20,
    "failed": 0,
    "total_items": 42
  }
}
'''

data = json.loads(results_json)

# æ”¶é›†æ‰€æœ‰åŸå§‹ç»“æœ
all_items = []
for platform, result in data["results"].items():
    for item in result["items"]:
        item_copy = item.copy()
        item_copy["_platform"] = platform
        all_items.append(item_copy)

print("=" * 60)
print("ğŸ“Š Union Search æœç´¢ç»“æœç»Ÿè®¡åˆ†æ")
print("=" * 60)
print(f"\nã€æœç´¢å‚æ•°ã€‘")
print(f"  - æœç´¢å…³é”®è¯: AIäººå·¥æ™ºèƒ½")
print(f"  - å¹³å°æ•°é‡: {data['summary']['total_platforms']}")
print(f"  - æ¯å¹³å°é™åˆ¶: 3æ¡")

print(f"\nã€ç›´æ¥æœç´¢ç»“æœã€‘")
print(f"  - åŸå§‹è¿”å›æ€»æ•°: {data['summary']['total_items']} æ¡")

# ç»Ÿè®¡å„å¹³å°è¿”å›æ•°é‡
print(f"\nã€å„å¹³å°è¿”å›æ•°é‡ã€‘")
for platform, result in data["results"].items():
    count = len(result["items"])
    status = "âœ…" if count > 0 else "âš ï¸ "
    print(f"  {status} {platform:15s}: {count} æ¡")

# æå–URL/é“¾æ¥è¿›è¡Œå»é‡
def get_url(item):
    """ä»ä¸åŒå¹³å°çš„itemä¸­æå–URL"""
    for key in ['url', 'link', 'href', 'html_url']:
        if key in item and item[key]:
            return item[key]
    return None

# æŒ‰URLå»é‡
urls_seen = set()
unique_by_url = []
duplicates_by_url = []

for item in all_items:
    url = get_url(item)
    if url:
        # æ ‡å‡†åŒ–URL
        url_normalized = url.rstrip('/').lower()
        if url_normalized not in urls_seen:
            urls_seen.add(url_normalized)
            unique_by_url.append(item)
        else:
            duplicates_by_url.append(item)
    else:
        # æ— URLçš„itemä¿ç•™
        unique_by_url.append(item)

# æŒ‰æ ‡é¢˜å»é‡ï¼ˆç›¸ä¼¼æ ‡é¢˜ï¼‰
def normalize_title(title):
    """æ ‡å‡†åŒ–æ ‡é¢˜ç”¨äºæ¯”è¾ƒ"""
    if not title:
        return ""
    return title.strip().lower()[:50]

titles_seen = {}
unique_by_title = []
duplicates_by_title = []

for item in unique_by_url:
    title = item.get('title', item.get('name', ''))
    norm_title = normalize_title(title)

    if norm_title and norm_title in titles_seen:
        duplicates_by_title.append({
            "current": item,
            "original": titles_seen[norm_title]
        })
    else:
        if norm_title:
            titles_seen[norm_title] = item
        unique_by_title.append(item)

print(f"\n" + "=" * 60)
print("ğŸ”„ å»é‡æ¸…æ´—ç»“æœ")
print("=" * 60)

print(f"\nã€URLå»é‡ã€‘")
print(f"  - æ¸…æ´—å‰: {len(all_items)} æ¡")
print(f"  - æ¸…æ´—å: {len(unique_by_url)} æ¡")
print(f"  - å»é‡æ•°é‡: {len(all_items) - len(unique_by_url)} æ¡")

print(f"\nã€æ ‡é¢˜å»é‡ã€‘ï¼ˆåœ¨URLå»é‡åŸºç¡€ä¸Šï¼‰")
print(f"  - æ¸…æ´—å‰: {len(unique_by_url)} æ¡")
print(f"  - æ¸…æ´—å: {len(unique_by_title)} æ¡")
print(f"  - å»é‡æ•°é‡: {len(unique_by_url) - len(unique_by_title)} æ¡")

print(f"\n" + "=" * 60)
print("ğŸ“ˆ æœ€ç»ˆç»Ÿè®¡æ±‡æ€»")
print("=" * 60)
print(f"  â”œâ”€ åŸå§‹æœç´¢ç»“æœ: {len(all_items)} æ¡")
print(f"  â”œâ”€ æ¸…æ´—åç»“æœ:   {len(unique_by_title)} æ¡")
print(f"  â”œâ”€ æ€»å»é‡æ•°é‡:   {len(all_items) - len(unique_by_title)} æ¡")
print(f"  â””â”€ å»é‡ç‡:       {(len(all_items) - len(unique_by_title)) / len(all_items) * 100:.1f}%")

if duplicates_by_url:
    print(f"\nã€URLé‡å¤é¡¹è¯¦æƒ…ã€‘({len(duplicates_by_url)}æ¡)")
    for dup in duplicates_by_url:
        title = dup.get('title', dup.get('name', 'N/A'))
        print(f"  - [{dup['_platform']}] {title[:50]}...")

if duplicates_by_title:
    print(f"\nã€æ ‡é¢˜ç›¸ä¼¼é‡å¤é¡¹è¯¦æƒ…ã€‘({len(duplicates_by_title)}æ¡)")
    for dup in duplicates_by_title:
        curr = dup['current']
        orig = dup['original']
        curr_title = curr.get('title', curr.get('name', 'N/A'))
        orig_title = orig.get('title', orig.get('name', 'N/A'))
        print(f"  å½“å‰: [{curr['_platform']}] {curr_title[:40]}")
        print(f"  åŸå§‹: [{orig['_platform']}] {orig_title[:40]}")
        print()

print("=" * 60)
print("âœ… åˆ†æå®Œæˆ")
print("=" * 60)
